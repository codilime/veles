#!/usr/bin/env python

from __future__ import unicode_literals, print_function

from datetime import datetime
from six import text_type

from veles.scli import client
from veles.schema.nodeid import NodeID
from veles.util import helpers

parser = helpers.get_client_argparse()
parser.add_argument('file', help='path to a file to upload', type=text_type)
args = parser.parse_args()

client = client.create_client(args.server, args.server_auth_key)

with open(args.file, 'rb') as f:
    data = f.read()

id = client.create(NodeID.root_id,
    tags={'blob', 'blob.file', 'blob.stored',},
    attr={
        'name': args.file,
        'path': args.file,
        'width': 8,
        'base': 0,
        'size': len(data),
        'time_uploaded': datetime.utcnow(),
    },
    bindata={
        'data': data,
    }
)
print('CREATED', id)
